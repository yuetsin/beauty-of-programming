# 1.12 Nim 之二：「拈」游戏分析

## ★★★

我们再来看一个类似的游戏：

有 $N$ 块石头和两个玩家 A、B。

玩家 A 先将石头分成若干个「堆」，然后由两个玩家按照「B、A、B、A、…」的顺序不断取石头。

玩家在进行每次「取」时，只能从剩余的若干堆石头中选择一堆，并从中取走任意块（必须大于 $1$）石头。

能将当前剩余的所有石头一次取完的玩家获得胜利。

请问：玩家 A 应该采取怎样的分配和取石头策略才能保证自己必胜？

## 解

### Thoughts

我们还是从特别的 $N$ 开始思考。这里，我们将这 $N$ 块石头形成的堆的数量记作 $S_N$。显然 $S_N \le N$。

对 $S_N$ 进行讨论：

#### One Heap Only

* $S_N = 1, N \in \mathbb{N_+}$
	* 如果 A 仅仅将石头分配为 $1$ 堆，那么 B 直接拿走这堆石头取得胜利。
	* ~~（应该不会有人这么分吧~~

#### Two Stones, Two Heaps

* $S_N = 2, N = 2$
	* 也就是 A 将石头分配为 $(1, 1)$ 的形式。此时 A 必胜。
	* 我们将这种情况称之为「安全情况」，也就是在此情况下後手玩家必胜、先手玩家必输的情况。
	* 可以把「没有剩余石头了」当作一种特殊的安全情况。

#### Two Heaps, Generally

* $S_N = 2, N \gt 2$
	* 这里分为两种情况讨论：石头分成 $(1, N - 1)$，或者 $(i, N - i), i \ne 1$。
	* 对于 $(1, N - 1)$ 情况来说，显然不是安全的；因为此时的先手玩家可以从 $N - 1$ 个石头组成的堆中取出 $N - 2$ 个石头，将其转化为 $(1, 1)$，同时先後手交换。
	* 换句话说，如果在一次拿取后形成了「安全局面」，那么游戏就已经结束了；拿取这次的玩家已经胜利。
	* 因此，始终应该避免产生「能通过『一次拿取』转化为『安全局面』」的局面。如果任何拿取方式都无法避免，那么这里就已经输掉了。

#### Prove $(X, X)$ is Safe

证明：从 A 的视角来看。

无论 B 从此中取走多少块石头，A 都能从另一个堆中取走同样多块，从而归化到另一个情况 $(X', X')$，同样是 B 先手。

然而每次进行拿取之後石头数量都会减少，也就是说
$$
X'^{\dots} \lt \dots \lt X''' \lt X'' \lt X' \lt X
$$
无穷递降法，可以得出情况最终会归化到 $(1, 1)$，B 先手。

而此时 B 是必输的。

因此，一般的 $(X, X)$ 对于 A 来说是必赢情况。

### Conclusion I

根据 $(X, X)$ 是必胜情况，可以得到：如果石头的数量 $N$ 是偶数，那么直接将其分为相等的两堆，即可必胜。

> 那如果是奇数呢？

### Deeper Thoughts

还是从特殊的情况开始思考。

#### Trinity

考虑 $N = 3$ 的情况。除开 $(3)$ 这种摆法以外，正常 A 会考虑的摆法只有两种：

* $(2, 1)$
* $(1, 1, 1)$

遗憾的是，B 总是可以通过 $1$ 次拿取，将局面化为对 B 的安全局面。

也就是说，$N = 3$ 时，A 必输。

> 再尝试一下 $N = 5$ 和 $N = 7$，发现先拿者似乎完全无法取胜。

好像没有得到什么进步性的结论啊。

#### The "Ones"

考虑最特殊的分配方法：A 将 $N$ 块石头分成 $N$ 堆，每堆仅有 $1$ 块。

很显然，在 $N$ 是奇数时，A 必输；而 $N$ 为偶数时，$A$ 必胜。

那么，再考虑 $(1, 1, 1, \dots, X)$ 这种情况（$X \gt 1$）。

这时，先拿者的操作空间就来了。

如果目前有偶数个堆，那么先拿者可以从 $X$ 块石头的堆中拿走 $X - 1$ 块，转化成「偶数个 $1$」的堆，他必胜。

如果目前有奇数个堆，那么先拿者可以直接完全拿走 $X$ 块石头的堆，剩下「偶数个 1」的堆，他也必胜。

因此，$(1, 1, 1, \dots, X)$ 的情况对于先手是必胜的。因此 A 绝不会希望把石头摆成这样。

#### Key Point

分析了这么多特殊的情况，有没有更加一般化的制胜策略呢？

考虑一般的 $(S_a, S_b, \dots)$ 石堆的胜负情况。

首先，最终的胜利情况是 $(0, 0, \dots, 0, 0)$。

> 为了方便思考，这里把那些「被拿光了的」石堆，也就是石头数量变成 $0$ 的石堆也表示了出来。

此时，$(S_a \oplus S_b \oplus \dots)$ 应该为 $0$。

而考虑到在给出奇数块石头 $N$ 的情况下，无论怎么分配一定有奇数个堆的石头数量是奇数。也就是说，$(S_a \oplus S_b \oplus \dots)$ 的二进制表示的最低位一定是 $1$，即非 $0$。

而在 $(S_a \oplus S_b \oplus \dots)$ 非 $0$ 时，只要我们拿走「这个异或结果对应的石头块数」，就可以让剩余石头的异或结果变成 $0$。

> 因为 $(S_a \oplus S_b \oplus \dots) \le \max \lbrace S_a, S_b, \dots \rbrace$，所以一定可以拿这么多块。

但是，只要从一个 $(S_a \oplus S_b \oplus \dots)$ 为 $0$ 的局面中拿走一些石头，那么 $(S_a \oplus S_b \oplus \dots)$ 就会变成非 $0$。

因此，可以理解成采取「异或值为 $0$」和「异或值非 $0$」之间来回切换的动机；始终保证在自己拿完一手之後，剩余石头的异或值为 $0$。

而石头的数量是有限的；每次交手石头的数量都会减少。

根据无穷递降原理，可以知道最後一次「异或值为 $0$」的情况，就是石头数量全 $0$ 的情况。

也就是，能够享有「异或值非 $0$」的条件下先手的人就能取得胜利。

> 这样，可以看出实际上 $(X, X)$ 这种安全情况只不过是「异或」观点下的一种特殊情况。

而因为奇数块石头无论怎么分配异或值都不为 $0$，所以在这种情况下 A 必输无疑。

## 跋

找到「安全情况」背后隐藏的决定因素，再加上「无穷递降」归化到平凡情况，就好了。

> 下一节，还有另一版本的 Nim 玩。

