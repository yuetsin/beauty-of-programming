# 1.6 饮料供货

## ★★★

在微软亚洲研究院上班，大家早上来的第一件事是干啥呢？查看邮件？No，是去水房拿饮料：酸奶、豆浆、绿茶、王老吉、咖啡、**可口**可乐……（当然，还是有很多同事把拿饮料当做第二件事）。

管理水房的阿姨们每天都会准备很多的饮料给大家。为了提高服务质量，他们会统计大家对每种饮料的满意度。一段时间後，阿姨们已经有了大批的数据。某天早上，当实习生小飞第一个冲进水房并一次拿了五瓶酸奶、四瓶王老吉、三瓶鲜橙多时，阿姨们逮住了他，要他帮忙。

从阿姨们统计的数据中，小飞可以知道大家对每一种饮料的满意度。阿姨们还告诉小飞，STC（*Smart Tea Corp*）负责给研究院供应饮料，每天的总量（总容量）为 $V$。STC 很神奇，他们提供的每种饮料之单个容量都是 $2^n$，比如王老吉，都是 $2^3 = 8$ 升的，**可口**可乐都是 $2^5 = 32$ 升的。当然 STC 的存货也是有限的，这会是每种饮料购买量的上限。统计数据中用饮料名字、容量、数量、满意度来描述每一种饮料。

那么，小飞如何完成这个任务，求出保证最大满意度的购买量呢？

## 解

### Abstraction

我们先数学化地表述一下这个问题吧？

根据上面的表述，研究院每天需要购买的饮料总容量为 $V$。而每种饮料具有五枚属性，用元组 $(S_i, V_i, C_i, H_i, B_i)$ 来表示。

其中 $S_i$ 代表饮料的名字；$V_i$ 表示饮料的容量；$C_i$ 表示 STC 所能供应的最大库存；$H_i$ 代表饮料的满意度；$B_i$ 代表当前的实际购买量。

「可能的最大数量」指的是如果只购买某种饮料的话，最大可以买多少数量。这一数字受到 STC 供货和冰柜大小的双重制约。例如对于第 $i$ 种饮料，可能购买的最大数量是 $\min \lbrace \frac {V} {V_i}, C_i \rbrace$。这个数字和给定的冰柜大小 $V$ 有关，因此不应将其和饮料种类硬编码到一起。

因此，我们这么设计数据结构：

```python
class Drink:
    name = ""
    volume = 0
    max_amount = 0
    satisfactoriness = 0.0
```

> 参见 `./src/drinks.py`。

因此，当前购买的所有饮料占用的总容量是 $\sum_{i=0}^{n-1}(V_i \times B_i)$；总满意度是 $\sum_{i=0}^{n-1}(H_i \times B_i)$。

因为研究院的冰柜最多只能存放容量为 $V$ 的饮料，所以我们的目的是在保证 $\sum_{i=0}^{n-1}(V_i \times B_i) \le V$ 的基础上，使 $\sum_{i=0}^{n-1}(H_i \times B_i)$ 尽可能大。

### Dynamic Programming

动态规划法很适合这种「最优化」问题。

我们用 $Opt(V', i)$ 来表示当总体积不超过 $V'$ 的情况下、从第 $i$、$i + 1$、$i + 2$、…、$n - 1$、$n$ 种饮料中，算出所有方案中满意度之和的最大值。

显然，最后的结果由 $Opt(V, 0)$ 给出。

那么，我们可以给出这样的递归公式：
$$
Opt(V', i) = \max \lbrace k \times H_i + Opt(V' - V_i \times k, i - 1) \rbrace
$$
其中 $k$ 取 $[0, C_i]$ 内的任意整数，$i$ 取 $[0, n - 1]$ 内的任意整数。

此动态规划需要给出以下边界条件：

$Opt(0, n) = 0$。

即在冰柜容量为 $0$ 时，最优的结果也是 $0$。

$Opt(x, n) = -\inf,\ x \ne 0 $。

即在容量不为 0 的情况下，将初始值设定为 $-\inf$。

根据上面的推导公式，比较容易写出 DP 代码。

> 参见 `./src/dp.py`。

![image-20200218114941522](readme.assets/image-20200218114941522.png)

> 根据这里的运行结果，可以明显地发现限制条件的变化。
>
> 一开始，限制条件是冰柜的大小——在冰柜容量小于 4 的时候，只够存放 1 单位的「王老吉」，对应满意度为 9；
>
> 随后，随着冰柜数量渐渐增大，满意度逐渐增加；直到最后，研究院的冰箱大到可以装下 STC 所有的供货；此时满意度达到最大值，即 1151。

